---
import Layout from '../layouts/Layout.astro';
import ProductList from '../components/ProductList.tsx';
import { sections, getAllCategoriesFlat } from '../data/categories.js';

// Generar rutas estáticas
export function getStaticPaths() {
    return Object.keys(sections).map(sectionKey => ({
        params: { section: sectionKey }
    }));
}

const { section } = Astro.params;

// Obtener configuración de la sección
const sectionConfig = sections[section];

// Si no existe la sección, redirigir a 404
if (!sectionConfig) {
    return Astro.redirect('/404');
}

// Productos de ejemplo (después los reemplazarás con datos reales)
const productos = [
    {
        id: 1,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
        featured: true,
        bestSeller: true,
        onSale: false,
        backInStock: false,
    },
    {
        id: 2,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
        featured: false,
        bestSeller: true,
        onSale: true,
        backInStock: false,
    },
    {
        id: 3,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
        featured: true,
        bestSeller: false,
        onSale: false,
        backInStock: true,
    },
    {
        id: 4,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
        featured: false,
        bestSeller: false,
        onSale: true,
        backInStock: false,
    },
];

// Filtrar productos según la sección
let filteredProducts = productos;
let categories: { id: string; label: string }[] = [];

if (sectionConfig.isCategories) {
    // Para "Por Necesidad", mostrar categorías
    const allCats = getAllCategoriesFlat();
    categories = allCats.map((cat: any) => ({ id: cat.id, label: cat.label }));
} else {
    // Filtrar productos según el filterKey
    filteredProducts = productos.filter(product => product[sectionConfig.filterKey as keyof typeof product] === true);
}
---

<Layout title={sectionConfig.titulo}>
    <main>
        <ProductList 
            client:load
            products={filteredProducts} 
            title={sectionConfig.titulo}
            showFilters={!sectionConfig.isCategories}
            categories={categories}
        />
    </main>
</Layout>
