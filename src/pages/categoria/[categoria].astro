---
import Layout from '../../layouts/Layout.astro';
import ProductList from '../../components/ProductList.tsx';
import { allCategories } from '../../data/categories.js';

// Generar rutas estáticas
export function getStaticPaths() {
    return allCategories.map(cat => ({
        params: { categoria: cat.id }
    }));
}

const { categoria } = Astro.params;

// Buscar la categoría
const categoryData = allCategories.find(cat => cat.id === categoria);

// Si no existe la categoría, redirigir a 404
if (!categoryData) {
    return Astro.redirect('/404');
}

// Subcategorías para el filtro
const subcategories = categoryData.subcategories?.map((sub: any) => ({ 
    id: sub.id, 
    label: sub.label 
})) || [];

// Productos de ejemplo (después los reemplazarás con datos reales)
const productos = [
    {
        id: 1,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
        featured: true,
    },
    {
        id: 2,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
    },
    {
        id: 3,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
    },
    {
        id: 4,
        name: 'Nombre del producto 1',
        brand: 'Marca del producto',
        price: '100',
        image: 'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop',
    },
];
---

<Layout title={categoryData.label}>
    <main>
        <ProductList 
            client:load
            products={productos} 
            title={categoryData.label}
            showFilters={true}
            categories={subcategories}
        />
    </main>
</Layout>
